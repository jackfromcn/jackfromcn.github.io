---
title: linx 常用命令 —— awk 
date: 2019-10-25 17:35:27
tags:
 - linux
---

### awk 简介
awk是一种编程语言（解释性语言，不需要编译），**用于数据截取和报告的工具**
awk自动搜索输入的文件，并把每个输入行切分成多个字段（字段：根据分隔符分割成的单元）
擅长处理数据库和表型数据。适合编写短小一次性程序
centos默认的awk使用的是gawk，系统将awk通过软链接来指向gawk
可以使用新的内置函数和变量
**在缺省的情况下，它使用扩展的正则表达式**
awk不需要声明变量的数据类型，它内置字符串类型和数值类型

### awk语法结构
```bash
awk [OPTIONS] [--] program filename_list
# OPTIONS 选项
# -V:                   显示awk版本
# -f program-file:      指定包含了awk命令的文件，不是从命令行参数中去读取,可以通过-f选项指定多个包含awk命令文件  
# -F'fs'
# --field-separator:    指定分隔符即为定义FS变量对应的值
# -v var=val:           在程序开始之前，将val这个值赋给var这个变量
# -d[file]:             将全局变量的类型和最终值排序，并将排序好后的结果打印输出到文件中

awk '$2 >= 50 { print $1,$2*$3 }' data.txt
```
**说明：**
* awk命令后面的程序用单引号引起来，单引号后面的部分为输入文件
* 单引号中包围的内容是一个awk程序，是一个program即模式-动作语句（pattern-action）
    * 其中模式pattern为'$2>=50'，表示扫描每一个输入的行，如果第二列大于0，则执行动作action，否则不执行action
    * 动作action为'{ print $1,$2*$3 }',模式匹配成功后执行的对应动作，该动作用于打印输出第一个字段和第二、三字段的乘积


```bash
# 测试数据
cat data.txt
Simon 96 97 99
Bei 92 100 95
Tom 100 92 97
Tim 80 99 99

# 
awk 'BEGIN{OFS=":";ORS="\n\n"} BEGIN{print "name:total_salary"} {print $1,$2*$3}' date

```





```bash
cat ods_03_xyka_mtdz_20191024.txt|awk -F '|' '{print $5}' > test.txt
cat test.txt|awk '{sum+=$1} END {print "Sum = ", sum}'
```

### 关键字解析

#### 文本数据提取
```bash
cat info.log|awk -F '请求时长:' '$2 == 404 {sum+=$2} END {print sum}'

cat info.log|awk -F '请求时长:' '$2 == 404 {sum+=$2} END {print sum}'|uniq| sort -rh
```

#### json 关键字解析
json 解析示例:
```plaintext
{
  "faces": [
    {
      "face_token": "ff5bda3d50e933584a28722afd8f9b2e",
      "face_rectangle": {
        "height": 113,
        "left": 198,
        "top": 125,
        "width": 113
      },
      "attributes": {
        "age": {
          "value": 26
        },
        "gender": {
          "value": "Female"
        }
      }
    }
  ],
  "time_used": 292,
  "request_id": "1493524184,9bbee040-d1f0-4681-be0a-96dbf9a4d018",
  "image_id": "6kox5v0GjhI9f+MWEc3wIA=="
}
```

```bash
#      "face_token": "ff5bda3d50e933584a28722afd8f9b2e",
cat test.json | awk -F "[face_token]" '/face_token/{print$0}'
jq '.faces' test.json|jq '.[0].face_token'

# 113
jq '.faces[0].face_rectangle.height' test.json

# {
#  "message": 113
# }
jq '.faces[0].face_rectangle.height | {message: .}' test.json
jq '.faces' test.json|jq '.[]| { message: .face_rectangle.height}'
```

优秀参考链接:
https://blog.csdn.net/mr_bei/article/details/83112860