---
title: 提取pfx证书公钥和私钥
date: 2019-11-05 16:32:36
categories: ssl
tags:
 - open ssl
 - 验签
---

> 从pfx提取密钥信息，并转换为key格式（pfx使用pkcs12模式补足）

## 方法一
### 提取 pem 格式文件
```bash
openssl pkcs12 -in myssl.pfx -nodes -out server.pem （使用这步骤就ok了，因为pem格式可以打开了） 
```

### 提取私钥 
```bash
openssl rsa -in server.pem -out server.key
```

### 提出公钥
```bash
openssl x509 -in server.pem -out server.crt
```

## 方法二
### 提取密钥对（如果pfx证书已加密，会提示输入密码。）
```bash
openssl pkcs12 -in 1.pfx -nocerts -nodes -out 1.key
```

### 从密钥对提取私钥
```bash
openssl rsa -in 1.key -out 1_pri.key
```

### 从密钥对提取公钥
```bash
openssl rsa -in 1.key -pubout -out 1_pub.key
```

### 因为RSA算法使用的是pkcs8模式补足，需要对提取的私钥进一步处理（可选）
```bash
openssl pkcs8 -in 1_pri.key -out 1_pri.p8 -outform der -nocrypt -topk8
```

## 方法三：代码提取
### java 代码进行提取

```java
import com.sun.org.apache.xerces.internal.impl.dv.util.Base64;

import javax.net.ssl.SSLSession;
import java.io.*;
import java.security.KeyStore;
import java.security.PrivateKey;
import java.security.PublicKey;
import java.security.cert.Certificate;
import java.security.interfaces.RSAPrivateKey;
import java.util.Enumeration;

    public static void main(String[] args) throws Exception {
       readPfx("server.pfx", "password");
    }

    public static void readPfx(String certPath, String password)throws Exception {
        KeyStore ks = KeyStore.getInstance("PKCS12");
        FileInputStream fis = new FileInputStream(certPath);
        ks.load(fis, password.toCharArray());
        System.out.println("证书类型___:"+ ks.getType());
        Enumeration enumas = ks.aliases();
        String aliases = null;
        if (enumas.hasMoreElements()){
            aliases = (String) enumas.nextElement();
            System.out.println("证书别名Alias___:"+aliases);
        }
        Certificate cert = ks.getCertificate(aliases);
        PublicKey pubkey = cert.getPublicKey();
        System.out.println("公钥___:"+pubkey);
        byte[] encoded = pubkey.getEncoded();
        String alg = pubkey.getAlgorithm();
        String format = pubkey.getFormat();
        System.out.println(Base64.encode(encoded));
        System.out.println("is key entry=" + ks.isKeyEntry(aliases));
        PrivateKey prikey = (PrivateKey) ks.getKey(aliases,password.toCharArray());
        System.out.println("私钥___:"+prikey);
        byte[] priEncode = prikey.getEncoded();
        System.out.println(Base64.encode(priEncode));
    }
```